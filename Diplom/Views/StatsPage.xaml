<?xml version="1.0" encoding="utf-8"?>
<ContentPage x:Class="Diplom.Views.StatsPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:chart="clr-namespace:Microcharts.Maui;assembly=Microcharts.Maui"
             xmlns:vm="clr-namespace:Diplom.ViewModels"
             Title="Статистика">


    <VerticalStackLayout Padding="24" Spacing="20">

        <HorizontalStackLayout HorizontalOptions="Center" Spacing="12">
            <Button Text="За день"
                    Command="{Binding ShowDayCommand}" />

            <Button Text="Интервал"
                    Command="{Binding ShowRangeCommand}" />
        </HorizontalStackLayout>


        <VerticalStackLayout x:Name="DayPanel" Spacing="12">
            <DatePicker Date="{Binding SelectedDate}" />
            <Button Text="Показать"
                    Command="{Binding BuildPieCommand}" />

            <chart:ChartView Chart="{Binding Chart}"
                             HeightRequest="300"
                             HorizontalOptions="Fill" />

            <VerticalStackLayout.Triggers>
                <DataTrigger TargetType="VerticalStackLayout"
                             Binding="{Binding Mode}"
                             Value="{x:Static vm:StatsViewModel+StatsMode.Day}">
                    <Setter Property="IsVisible" Value="True"/>
                </DataTrigger>
                <DataTrigger TargetType="VerticalStackLayout"
                             Binding="{Binding Mode}"
                             Value="{x:Static vm:StatsViewModel+StatsMode.Range}">
                    <Setter Property="IsVisible" Value="False"/>
                </DataTrigger>
            </VerticalStackLayout.Triggers>
        </VerticalStackLayout>


        <VerticalStackLayout x:Name="RangePanel" Spacing="12">
            <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                <VerticalStackLayout>
                    <Label Text="От:" FontAttributes="Bold" />
                    <DatePicker Date="{Binding FromDate}" />
                </VerticalStackLayout>

                <VerticalStackLayout Grid.Column="1">
                    <Label Text="До:" FontAttributes="Bold" />
                    <DatePicker Date="{Binding ToDate}" />
                </VerticalStackLayout>
            </Grid>

            <Button Text="Показать"
                    Command="{Binding BuildRangeCommand}" />

            <chart:ChartView Chart="{Binding Chart}"
                             HeightRequest="320"
                             HorizontalOptions="Fill" />

            <VerticalStackLayout.Triggers>
                <DataTrigger TargetType="VerticalStackLayout"
                             Binding="{Binding Mode}"
                             Value="{x:Static vm:StatsViewModel+StatsMode.Range}">
                    <Setter Property="IsVisible" Value="True"/>
                </DataTrigger>
                <DataTrigger TargetType="VerticalStackLayout"
                             Binding="{Binding Mode}"
                             Value="{x:Static vm:StatsViewModel+StatsMode.Day}">
                    <Setter Property="IsVisible" Value="False"/>
                </DataTrigger>
            </VerticalStackLayout.Triggers>
        </VerticalStackLayout>

    </VerticalStackLayout>
</ContentPage>
